!function(){"use strict";var e=document.getElementById("resultats-container"),t=document.getElementById("results-count"),n=document.getElementById("results-stats"),a=document.getElementById("filter-year"),s=document.getElementById("filter-circuit"),r=document.getElementById("filter-competition"),i=document.getElementById("filter-categorie"),o=document.getElementById("filter-podium"),c=document.getElementById("filter-reset");if(e){var u={},d=["jan.","fÃ©v.","mars","avr.","mai","juin","juil.","aoÃ»t","sept.","oct.","nov.","dÃ©c."],l={date:"Date",competition:"CompÃ©tition",circuit:"Circuit",categorie:"CatÃ©gorie",cumul:"Cumul",prefinale:"PrÃ©-Finale",finale:"Finale",resultat:"RÃ©sultat"};a&&a.addEventListener("change",E),s&&s.addEventListener("change",E),r&&r.addEventListener("change",E),i&&i.addEventListener("change",E),o&&o.addEventListener("change",E),c&&c.addEventListener("click",function(){a.value="",s.value="",r.value="",i&&(i.value=""),o.value="",E()}),fetch("/data/resultats.json").then(function(e){if(!e.ok)throw new Error("Erreur de chargement");return e.json()}).then(function(e){0;var t=function(e){var t={},n=new Set;return e.championnats.forEach(function(e){var a=e.annee;!a&&e.courses&&e.courses.length>0&&(a=f(e.courses[0].dateDebut)),a&&(n.add(a),t[a]||(t[a]={championnats:[],courses:[]}),t[a].championnats.push(e))}),e.courses.forEach(function(e){var a=f(e.dateDebut);a&&(n.add(a),t[a]||(t[a]={championnats:[],courses:[]}),t[a].courses.push(e))}),e.infos&&Object.keys(e.infos).forEach(function(a){var s=parseInt(a,10);n.add(s),t[s]?t[s].info=e.infos[a]:t[s]={championnats:[],courses:[],info:e.infos[a]}}),Object.keys(t).forEach(function(e){t[e].championnats.forEach(function(e){e.courses&&e.courses.length>1&&e.courses.sort(function(e,t){return(e.dateDebut||"").localeCompare(t.dateDebut||"")})}),t[e].courses.length>1&&t[e].courses.sort(function(e,t){return(e.dateDebut||"").localeCompare(t.dateDebut||"")})}),{byYear:t,years:Array.from(n).sort(function(e,t){return t-e})}}(e);u=t,function(e,t){var n=new Set,o=new Set,c=new Set;e.championnats.forEach(function(e){o.add(e.nom),c.add(e.categorie),e.courses&&e.courses.forEach(function(e){e.circuit&&n.add(e.circuit),e.categorie&&c.add(e.categorie)})}),e.courses.forEach(function(e){e.circuit&&n.add(e.circuit),e.competition&&o.add(e.competition),e.categorie&&c.add(e.categorie)}),t.forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)}),Array.from(n).sort().forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,s.appendChild(t)}),Array.from(o).sort().forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,r.appendChild(t)}),i&&Array.from(c).sort().forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,i.appendChild(t)})}(e,t.years),function(e){if(n){var t=0,a=0,s=0,r=new Set,i=new Set;e.championnats.forEach(function(e){e.courses&&e.courses.forEach(function(e){t++,e.circuit&&r.add(e.circuit);var n=f(e.dateDebut);n&&i.add(n),e.podium&&(a++,m(e.finale||e.resultat)&&s++)})}),e.courses.forEach(function(e){t++,e.circuit&&r.add(e.circuit);var n=f(e.dateDebut);n&&i.add(n),e.podium&&(a++,m(e.finale||e.resultat)&&s++)}),n.innerHTML='<div class="stats-grid"><div class="stat-item"><span class="stat-value">'+i.size+'</span><span class="stat-label">Saisons</span></div><div class="stat-item"><span class="stat-value">'+t+'</span><span class="stat-label">Courses</span></div><div class="stat-item"><span class="stat-value">'+a+'</span><span class="stat-label">Podiums</span></div><div class="stat-item"><span class="stat-value">'+s+'</span><span class="stat-label">Victoires</span></div><div class="stat-item"><span class="stat-value">'+r.size+'</span><span class="stat-label">Circuits</span></div></div>'}}(e),E()}).catch(function(t){console.error("Erreur:",t),e.innerHTML="<p>Erreur lors du chargement des rÃ©sultats.</p>"})}function f(e){return e?parseInt(e.substring(0,4),10):null}function m(e){var t=(e||"").toLowerCase();return-1!==t.indexOf("1er")||-1!==t.indexOf("vainqueur")||"champion"===t}function p(e,t){var n=["date"];t&&n.push("competition"),n.push("circuit"),e.some(function(e){return e.categorie})&&n.push("categorie"),e.some(function(e){return e.cumul})&&n.push("cumul"),e.some(function(e){return e.prefinale})&&n.push("prefinale");var a=e.some(function(e){return e.finale}),s=e.some(function(e){return e.resultat});return a?n.push("finale"):s&&n.push("resultat"),n}function v(e,t){var n="";return e.forEach(function(e){var a=e.podium?' class="result-podium"':"";n+="<tr"+a+">",t.forEach(function(t){var a="";a="date"===t?function(e,t){if(!e)return"";var n=new Date(e),a=n.getDate(),s=n.getMonth();if(!t)return a+" "+d[s];var r=new Date(t),i=r.getDate(),o=r.getMonth();return s===o?a+"-"+i+" "+d[s]:a+" "+d[s]+" - "+i+" "+d[o]}(e.dateDebut,e.dateFin):e[t]||"","circuit"===t&&e.manche&&(a=a?a+" "+e.manche:e.manche);var s=e.podium&&("finale"===t||"resultat"===t);s&&a&&(a=function(e){var t=e.toLowerCase();return-1!==t.indexOf("1er")||-1!==t.indexOf("vainqueur")||"champion"===t?"ðŸ¥‡ "+e:-1!==t.indexOf("2Ã¨me")||"vice-champion"===t?"ðŸ¥ˆ "+e:-1!==t.indexOf("3Ã¨me")?"ðŸ¥‰ "+e:e}(a)),n+="<td"+(s?' class="result-highlight"':"")+">"+a+"</td>"}),n+="</tr>"}),n}function h(e,t){return(!t.circuit||e.circuit===t.circuit)&&((!t.categorie||e.categorie===t.categorie)&&!(t.podium&&!e.podium))}function g(e,t){return!t||e===t||-1!==e.indexOf(t)}function E(){var n,c,d,f,m=a.value,E=s.value,b=r.value,y=i?i.value:"",x="true"===o.value,C={circuit:E,categorie:y,podium:x},L=[],w=0,O=0;(m?[parseInt(m,10)]:u.years).forEach(function(e){var t=u.byYear[e];if(t){var n={annee:e,info:t.info,championnats:[],courses:[]};t.championnats.forEach(function(e){var t=g(e.nom,b),a=!y||e.categorie===y,s=!x||e.podium;if(t&&a){var r={nom:e.nom,categorie:e.categorie,resultat:e.resultat,podium:e.podium,courses:[]};e.courses&&e.courses.forEach(function(e){h(e,C)&&(r.courses.push(e),w++,e.podium&&O++)}),(r.courses.length>0||s&&!E)&&n.championnats.push(r)}}),t.courses.forEach(function(e){g(e.competition,b)&&h(e,C)&&(n.courses.push(e),w++,e.podium&&O++)});var a=E||b||y||x;(n.championnats.length>0||n.courses.length>0||n.info&&!a)&&L.push(n)}}),n=L,c=""!==m,e.innerHTML="",n&&n.length>0?n.forEach(function(t,n){var a=c&&0===n;e.appendChild(function(e,t){var n=e.annee,a=document.createElement("div");a.className="season-accordion";var s=document.createElement("button");s.className="season-btn",t&&s.classList.add("active"),s.textContent="Saison "+n,s.setAttribute("aria-expanded",t?"true":"false"),s.addEventListener("click",function(){var e=this.nextElementSibling,t=this.classList.contains("active");document.querySelectorAll(".season-btn").forEach(function(e){e.classList.remove("active"),e.setAttribute("aria-expanded","false"),e.nextElementSibling&&e.nextElementSibling.classList.remove("active")}),t||(this.classList.add("active"),this.setAttribute("aria-expanded","true"),e&&e.classList.add("active"))});var r=document.createElement("div");if(r.className="season-content"+(t?" active":""),e.info)r.innerHTML='<div class="table-container"><p style="padding: 1rem; color: var(--color-text-muted);">'+e.info+"</p></div>";else{var i="";if(e.championnats&&e.championnats.length>0&&e.championnats.forEach(function(e){var t,n=e.podium?-1!==(t=(e.resultat||"").toLowerCase()).indexOf("1er")||-1!==t.indexOf("vainqueur")||"champion"===t?"ðŸ¥‡ ":-1!==t.indexOf("2Ã¨me")||"vice-champion"===t?"ðŸ¥ˆ ":-1!==t.indexOf("3Ã¨me")?"ðŸ¥‰ ":"":"",a=e.podium?" classement-podium":"";if(i+='<div class="competition-block">',i+='<div class="classement-header'+a+'">',i+='<span class="classement-competition">'+e.nom+"</span>",i+='<span class="classement-categorie">'+e.categorie+"</span>",i+='<span class="classement-result">'+n+e.resultat+"</span>",i+="</div>",e.courses&&e.courses.length>0){var s=p(e.courses,!1);i+='<div class="table-container"><table><thead><tr>',s.forEach(function(e){i+="<th>"+(l[e]||e)+"</th>"}),i+="</tr></thead><tbody>",i+=v(e.courses,s),i+="</tbody></table></div>"}i+="</div>"}),e.courses&&e.courses.length>0){var o=e.courses.some(function(e){var t=(e.competition||"").toLowerCase();return-1!==t.indexOf("monde")||-1!==t.indexOf("world")})?"Ã‰preuves nationales et internationales":"Ã‰preuves nationales",c=p(e.courses,!0);i+='<div class="competition-block autres-courses">',i+='<div class="classement-header autres-header">',i+='<span class="classement-competition">'+o+"</span>",i+="</div>",i+='<div class="table-container"><table><thead><tr>',c.forEach(function(e){i+="<th>"+(l[e]||e)+"</th>"}),i+="</tr></thead><tbody>",i+=v(e.courses,c),i+="</tbody></table></div>",i+="</div>"}r.innerHTML=i}return a.appendChild(s),a.appendChild(r),a}(t,a))}):e.innerHTML="<p>Aucun rÃ©sultat disponible avec ces filtres.</p>",d=w,f=O,t.innerHTML=d>0?"<strong>"+d+"</strong> course(s) trouvÃ©e(s) dont <strong>"+f+"</strong> podium(s)":"Aucune course trouvÃ©e avec ces filtres"}}();