!function(){"use strict";var e=document.getElementById("resultats-container"),t=document.getElementById("results-count"),n=document.getElementById("results-stats"),a=document.getElementById("filter-year"),r=document.getElementById("filter-circuit"),s=document.getElementById("filter-competition"),i=document.getElementById("filter-categorie"),o=document.getElementById("filter-podium"),c=document.getElementById("filter-reset"),u=document.getElementById("expand-all");if(e){var l=!1,d={},f=["jan.","fév.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],v={date:"Date",circuit:"Circuit",categorie:"Catégorie",chrono:"Chrono",m1:"M1",m2:"M2",m3:"M3",cumul:"Cumul",prefinale:"Pré-Finale","finale 1":"Finale 1","finale 2":"Finale 2","finale 3":"Finale 3",finale:"Finale",finaleB:"Finale B"},p=["date","circuit","categorie","chrono","m1","m2","m3","cumul","prefinale","finale 1","finale 2","finale 3","finale","finaleB"],m=["dateDebut","dateFin","manche","annee","nom","courses","competition","dnf","annulee"],h=["chrono","cumul","prefinale","finale","finale 1","finale 2","finale 3","finaleB","m1","m2","m3"];a&&a.addEventListener("change",C),r&&r.addEventListener("change",C),s&&s.addEventListener("change",C),i&&i.addEventListener("change",C),o&&o.addEventListener("change",C),c&&c.addEventListener("click",function(){a.value="",r.value="",s.value="",i&&(i.value=""),o.value="",C()}),u&&u.addEventListener("click",function(){var e=document.querySelectorAll(".season-btn"),t=document.querySelectorAll(".season-content");if(l=!l,e.forEach(function(e){l?(e.classList.add("active"),e.setAttribute("aria-expanded","true")):(e.classList.remove("active"),e.setAttribute("aria-expanded","false"))}),t.forEach(function(e){l?e.classList.add("active"):e.classList.remove("active")}),u){var n=u.querySelector(".expand-icon"),a=u.querySelector(".expand-text");l?(n.textContent="−",a.textContent="Tout replier"):(n.textContent="+",a.textContent="Tout déplier")}}),fetch("/data/resultats.json").then(function(e){if(!e.ok)throw new Error("Erreur de chargement");return e.json()}).then(function(e){0;var t=function(e){var t={},n=new Set;return e.competitions.forEach(function(e){var a=e.annee;!a&&e.courses&&e.courses.length>0&&(a=g(e.courses[0].dateDebut)),a&&(n.add(a),t[a]||(t[a]={competitions:[]}),t[a].competitions.push(e))}),e.infos&&Object.keys(e.infos).forEach(function(a){var r=parseInt(a,10);n.add(r),t[r]?t[r].info=e.infos[a]:t[r]={competitions:[],info:e.infos[a]}}),Object.keys(t).forEach(function(e){t[e].competitions.sort(function(e,t){var n=e.courses&&e.courses.length>0?e.courses[0].dateDebut:"",a=t.courses&&t.courses.length>0?t.courses[0].dateDebut:"";return(n||"").localeCompare(a||"")}),t[e].competitions.forEach(function(e){e.courses&&e.courses.length>1&&e.courses.sort(function(e,t){return(e.dateDebut||"").localeCompare(t.dateDebut||"")})})}),{byYear:t,years:Array.from(n).sort(function(e,t){return t-e})}}(e);d=t,function(e,t){var n=new Set,o=new Set,c=new Set;e.competitions.forEach(function(e){o.add(e.nom),c.add(e.categorie),e.courses&&e.courses.forEach(function(e){e.circuit&&n.add(e.circuit),e.categorie&&c.add(e.categorie)})}),t.forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)}),Array.from(n).sort().forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,r.appendChild(t)}),Array.from(o).sort().forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,s.appendChild(t)}),i&&Array.from(c).sort().forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,i.appendChild(t)})}(e,t.years),function(e){if(n){var t=0,a=0,r=0,s=new Set,i=new Set;e.competitions.forEach(function(e){b(e.resultat)&&(a++,E(e.resultat)&&r++),e.courses&&e.courses.forEach(function(e){t++,e.circuit&&s.add(e.circuit);var n=g(e.dateDebut);n&&i.add(n),b(e.finale)?(a++,E(e.finale)&&r++):b(e.finaleB)&&(a++,E(e.finaleB)&&r++)})}),n.innerHTML='<div class="stats-grid"><div class="stat-item"><span class="stat-value">'+i.size+'</span><span class="stat-label">Saisons</span></div><div class="stat-item"><span class="stat-value">'+t+'</span><span class="stat-label">Courses</span></div><div class="stat-item"><span class="stat-value">'+a+'</span><span class="stat-label">Podiums</span></div><div class="stat-item"><span class="stat-value">'+r+'</span><span class="stat-label">Victoires</span></div><div class="stat-item"><span class="stat-value">'+s.size+'</span><span class="stat-label">Circuits</span></div></div>'}}(e),C()}).catch(function(t){console.error("Erreur:",t),e.innerHTML="<p>Erreur lors du chargement des résultats.</p>"})}function g(e){return e?parseInt(e.substring(0,4),10):null}function E(e){var t=(e||"").toLowerCase();return"1"===t||"1er"===t||-1!==t.indexOf("vainqueur")}function b(e){if(!e)return!1;var t=e.toLowerCase();if("1er"===t||"vainqueur"===t)return!0;var n=e.match(/^(\d+)/);if(n){var a=parseInt(n[1],10);return a>=1&&a<=3}return!1}function x(e,t){var n="";return e.forEach(function(e){n+="<tr>",t.forEach(function(t){var a="";a="date"===t?function(e,t){if(!e)return"";var n=new Date(e),a=n.getDate(),r=n.getMonth();if(!t)return a+" "+f[r];var s=new Date(t),i=s.getDate(),o=s.getMonth();return r===o?a+"-"+i+" "+f[r]:a+" "+f[r]+" - "+i+" "+f[o]}(e.dateDebut,e.dateFin):e[t]||"","circuit"===t&&e.manche&&(a=a?a+" "+e.manche:e.manche),-1!==h.indexOf(t)&&a&&(a=function(e){if(!e)return"";var t=e.toLowerCase();if("dns"===t||"dnf"===t||"annulée"===t||""===e)return e;if("1er"===t||"vainqueur"===t)return'<span class="position-badge position-1">P1</span>';var n=e.match(/^(\d+)/);if(n){var a=n[1],r=e.substring(a.length).trim(),s="position-badge";parseInt(a,10)<=3&&(s+=" position-"+a);var i='<span class="'+s+'">P'+a+"</span>";return r?i+" "+r:i}return e}(a)),"finale"===t&&(e.dnf?a+=' <span class="status-badge status-dnf">DNF</span>':e.annulee&&(a='<span class="status-badge status-annulee">Annulée</span>')),n+="<td>"+a+"</td>"}),n+="</tr>"}),n}function y(e,t){var n=e.annee,a=document.createElement("div");a.className="season-accordion";var r=document.createElement("button");r.className="season-btn",t&&r.classList.add("active"),r.textContent="Saison "+n,r.setAttribute("aria-expanded",t?"true":"false"),r.addEventListener("click",function(){var e=this.nextElementSibling,t=this.classList.contains("active");document.querySelectorAll(".season-btn").forEach(function(e){e.classList.remove("active"),e.setAttribute("aria-expanded","false"),e.nextElementSibling&&e.nextElementSibling.classList.remove("active")}),t||(this.classList.add("active"),this.setAttribute("aria-expanded","true"),e&&e.classList.add("active"))});var s=document.createElement("div");if(s.className="season-content"+(t?" active":""),e.info)s.innerHTML='<div class="table-container"><p style="padding: 1rem; color: var(--color-text-muted);">'+e.info+"</p></div>";else{var i="";e.competitions&&e.competitions.length>0&&e.competitions.forEach(function(e){var t=e.resultat&&e.resultat.length>0;if(i+='<div class="competition-block">',i+='<div class="classement-header">',i+='<span class="classement-competition">'+e.nom+"</span>",i+='<span class="classement-categorie">'+e.categorie+"</span>",t&&(i+='<span class="classement-result">'+function(e){if(!e)return"";var t=e.match(/^(\d+)/);if(t){var n=t[1],a=e.substring(n.length).trim(),r="result-badge";parseInt(n,10)<=3&&(r+=" result-"+n);var s='<span class="'+r+'">P'+n+"</span>";return a?s+" "+a:s}return e}(e.resultat)+"</span>"),i+="</div>",e.courses&&e.courses.length>0){var n=function(e){var t=new Set;e.forEach(function(e){Object.keys(e).forEach(function(n){-1===m.indexOf(n)&&e[n]&&t.add(n)})});var n=["date","circuit"];return p.forEach(function(e){"date"!==e&&"circuit"!==e&&t.has(e)&&n.push(e)}),t.forEach(function(e){if(-1===n.indexOf(e)){var t=n.length,a=n.indexOf("finale"),r=n.indexOf("resultat");-1!==a?t=a:-1!==r&&(t=r),n.splice(t,0,e)}}),n}(e.courses);i+='<div class="table-container"><table><thead><tr>',n.forEach(function(e){i+="<th>"+function(e){return v[e]?v[e]:e.charAt(0).toUpperCase()+e.slice(1)}(e)+"</th>"}),i+="</tr></thead><tbody>",i+=x(e.courses,n),i+="</tbody></table></div>"}i+="</div>"}),s.innerHTML=i}return a.appendChild(r),a.appendChild(s),a}function C(){var n,c,f,v,p=a.value,m=r.value,h=s.value,g=i?i.value:"",E="true"===o.value,x={circuit:m,categorie:g,podium:E},C=[],L=0,S=0;if((p?[parseInt(p,10)]:d.years).forEach(function(e){var t=d.byYear[e];if(t){var n={annee:e,info:t.info,competitions:[]};t.competitions.forEach(function(e){var t,a,r=(t=e.nom,!(a=h)||t===a||-1!==t.indexOf(a)),s=!g||e.categorie===g,i=!E||b(e.resultat);if(r&&s){var o={nom:e.nom,categorie:e.categorie,resultat:e.resultat,courses:[]};e.courses&&e.courses.forEach(function(e){(function(e,t){return!(t.circuit&&e.circuit!==t.circuit||t.categorie&&e.categorie!==t.categorie||t.podium&&!b(e.finale))})(e,x)&&(o.courses.push(e),L++,b(e.finale)&&S++)}),(o.courses.length>0||i&&!m)&&n.competitions.push(o)}});var a=m||h||g||E;(n.competitions.length>0||n.info&&!a)&&C.push(n)}}),n=C,c=""!==p,e.innerHTML="",n&&n.length>0?n.forEach(function(t,n){var a=c&&0===n;e.appendChild(y(t,a))}):e.innerHTML="<p>Aucun résultat disponible avec ces filtres.</p>",f=L,v=S,t.innerHTML=f>0?"<strong>"+f+"</strong> course(s) trouvée(s) dont <strong>"+v+"</strong> podium(s)":"Aucune course trouvée avec ces filtres",l=!1,u){var A=u.querySelector(".expand-icon"),B=u.querySelector(".expand-text");A.textContent="+",B.textContent="Tout déplier"}}}();