!function(){"use strict";var e=document.getElementById("resultats-container"),t=document.getElementById("results-count"),n=document.getElementById("filter-year"),a=document.getElementById("filter-circuit"),r=document.getElementById("filter-competition"),i=document.getElementById("filter-categorie"),o=document.getElementById("filter-podium"),c=document.getElementById("filter-reset"),s=document.getElementById("expand-all");if(e){var u=!1,l={},d=["jan.","fév.","mars","avr.","mai","juin","juil.","août","sept.","oct.","nov.","déc."],f={date:"Date",circuit:"Circuit",categorie:"Catégorie",chrono:"Chrono",m1:"M1",m2:"M2",m3:"M3",cumul:"Cumul",prefinale:"Pré-Finale","finale 1":"Finale 1","finale 2":"Finale 2","finale 3":"Finale 3",finale:"Finale",finaleB:"Finale B"},m=["date","circuit","categorie","chrono","m1","m2","m3","cumul","prefinale","finaleB","finale 1","finale 2","finale 3","finale"],v=["dateDebut","dateFin","manche","annee","nom","courses","competition","dnf","annulee","pays"],p=["chrono","cumul","prefinale","finale","finale 1","finale 2","finale 3","finaleB","m1","m2","m3"];n&&n.addEventListener("change",y),a&&a.addEventListener("change",y),r&&r.addEventListener("change",y),i&&i.addEventListener("change",y),o&&o.addEventListener("change",y),c&&c.addEventListener("click",function(){n.value="",a.value="",r.value="",i&&(i.value=""),o.value="",y()}),s&&s.addEventListener("click",function(){var e=document.querySelectorAll(".season-btn"),t=document.querySelectorAll(".season-content");if(u=!u,e.forEach(function(e){u?(e.classList.add("active"),e.setAttribute("aria-expanded","true")):(e.classList.remove("active"),e.setAttribute("aria-expanded","false"))}),t.forEach(function(e){u?e.classList.add("active"):e.classList.remove("active")}),s){var n=s.querySelector(".expand-icon"),a=s.querySelector(".expand-text");u?(n.textContent="−",a.textContent="Tout replier"):(n.textContent="+",a.textContent="Tout déplier")}}),fetch("/data/resultats.json").then(function(e){if(!e.ok)throw new Error("Erreur de chargement");return e.json()}).then(function(e){0;var t=b(e);l=t,function(e,t){var o=new Set,c=new Set,s=new Set;e.competitions.forEach(function(e){c.add(e.nom),s.add(e.categorie),e.courses&&e.courses.forEach(function(e){e.circuit&&o.add(e.circuit),e.categorie&&s.add(e.categorie)})}),t.forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)}),Array.from(o).sort().forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,a.appendChild(t)}),Array.from(c).sort().forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,r.appendChild(t)}),i&&Array.from(s).sort().forEach(function(e){var t=document.createElement("option");t.value=e,t.textContent=e,i.appendChild(t)})}(e,t.years),y()}).catch(function(t){console.error("Erreur:",t),e.innerHTML="<p>Erreur lors du chargement des résultats.</p>"})}function h(e){if(!e)return!1;var t=e.match(/^(\d+)/);if(t){var n=parseInt(t[1],10);return n>=1&&n<=3}return!1}function g(e,t){var n="";return e.forEach(function(e){n+="<tr>",t.forEach(function(t){var a,r="";r="date"===t?function(e,t){if(!e)return"";var n=new Date(e),a=n.getDate(),r=n.getMonth();if(!t)return a+" "+d[r];var i=new Date(t),o=i.getDate(),c=i.getMonth();return r===c?a+"-"+o+" "+d[r]:a+" "+d[r]+" - "+o+" "+d[c]}(e.dateDebut,e.dateFin):e[t]||"","circuit"===t&&(e.pays&&(r=((a=e.pays)&&2===a.length?'<img class="flag-icon" src="/images/flags/'+a.toLowerCase()+'.svg" width="16" height="12" alt="'+a+'" title="'+a+'">':"")+" "+r),e.manche&&(r=r+" "+e.manche)),-1!==p.indexOf(t)&&r&&(r=function(e){if(!e)return"";var t=e.toLowerCase();if("dns"===t||"dnf"===t||"annulée"===t||""===e)return e;var n=e.match(/^(\d+)/);if(n){var a=n[1],r=e.substring(a.length).trim(),i="position-badge";parseInt(a,10)<=3&&(i+=" position-"+a);var o='<span class="'+i+'">P'+a+"</span>";return r?o+" "+r:o}return e}(r)),"finale"===t&&(e.dnf?r+=' <span class="status-badge status-dnf">DNF</span>':e.annulee&&(r='<span class="status-badge status-annulee">Annulée</span>')),n+="<td>"+r+"</td>"}),n+="</tr>"}),n}function E(e,t){var n=e.annee,a=document.createElement("div");a.className="season-accordion";var r=document.createElement("button");r.className="season-btn",t&&r.classList.add("active"),r.textContent="Saison "+n,r.setAttribute("aria-expanded",t?"true":"false"),r.addEventListener("click",function(){var e=this.nextElementSibling,t=this.classList.contains("active");document.querySelectorAll(".season-btn").forEach(function(e){e.classList.remove("active"),e.setAttribute("aria-expanded","false"),e.nextElementSibling&&e.nextElementSibling.classList.remove("active")}),t||(this.classList.add("active"),this.setAttribute("aria-expanded","true"),e&&e.classList.add("active"))});var i=document.createElement("div");if(i.className="season-content"+(t?" active":""),e.info)i.innerHTML='<div class="table-container"><p style="padding: 1rem; color: var(--color-text-muted);">'+e.info+"</p></div>";else{var o="";e.competitions&&e.competitions.length>0&&e.competitions.forEach(function(e){var t=e.resultat&&e.resultat.length>0,n=e.niveau||"regional";if(o+='<div class="competition-block">',o+='<div class="classement-header niveau-'+n+'">',o+='<span class="niveau-badge niveau-badge-'+n+'">'+("international"===n?"Mondiale":"national"===n?"Nationale":"Régionale")+"</span>",o+='<span class="classement-competition">'+e.nom+"</span>",o+='<span class="classement-categorie">'+e.categorie+"</span>",t&&(o+='<span class="classement-result">'+function(e){if(!e)return"";var t=e.match(/^(\d+)/);if(t){var n=t[1],a=e.substring(n.length).trim(),r="result-badge";parseInt(n,10)<=3&&(r+=" result-"+n);var i='<span class="'+r+'">P'+n+"</span>";return a?i+" "+a:i}return e}(e.resultat)+"</span>"),o+="</div>",e.courses&&e.courses.length>0){var a=function(e){var t=new Set;e.forEach(function(e){Object.keys(e).forEach(function(n){-1===v.indexOf(n)&&e[n]&&t.add(n)})});var n=["date","circuit"];return m.forEach(function(e){"date"!==e&&"circuit"!==e&&t.has(e)&&n.push(e)}),t.forEach(function(e){if(-1===n.indexOf(e)){var t=n.length,a=n.indexOf("finale"),r=n.indexOf("resultat");-1!==a?t=a:-1!==r&&(t=r),n.splice(t,0,e)}}),n}(e.courses);o+='<div class="table-container"><table><thead><tr>',a.forEach(function(e){o+="<th>"+function(e){return f[e]?f[e]:e.charAt(0).toUpperCase()+e.slice(1)}(e)+"</th>"}),o+="</tr></thead><tbody>",o+=g(e.courses,a),o+="</tbody></table></div>"}o+="</div>"}),i.innerHTML=o}return a.appendChild(r),a.appendChild(i),a}function b(e){var t={},n=new Set;return e.competitions.forEach(function(e){var a,r=e.annee;!r&&e.courses&&e.courses.length>0&&(r=(a=e.courses[0].dateDebut)?parseInt(a.substring(0,4),10):null),r&&(n.add(r),t[r]||(t[r]={competitions:[]}),t[r].competitions.push(e))}),e.infos&&Object.keys(e.infos).forEach(function(a){var r=parseInt(a,10);n.add(r),t[r]?t[r].info=e.infos[a]:t[r]={competitions:[],info:e.infos[a]}}),Object.keys(t).forEach(function(e){t[e].competitions.sort(function(e,t){var n=e.courses&&e.courses.length>0?e.courses[0].dateDebut:"",a=t.courses&&t.courses.length>0?t.courses[0].dateDebut:"";return(n||"").localeCompare(a||"")}),t[e].competitions.forEach(function(e){e.courses&&e.courses.length>1&&e.courses.sort(function(e,t){return(e.dateDebut||"").localeCompare(t.dateDebut||"")})})}),{byYear:t,years:Array.from(n).sort(function(e,t){return t-e})}}function y(){var c,d,f,m,v=n.value,p=a.value,g=r.value,b=i?i.value:"",y="true"===o.value,x={circuit:p,categorie:b,podium:y},C=[],L=0,A=0;if((v?[parseInt(v,10)]:l.years).forEach(function(e){var t=l.byYear[e];if(t){var n={annee:e,info:t.info,competitions:[]};t.competitions.forEach(function(e){var t,a,r=(t=e.nom,!(a=g)||t===a||-1!==t.indexOf(a)),i=!b||e.categorie===b,o=!y||h(e.resultat);if(r&&i){var c={nom:e.nom,categorie:e.categorie,resultat:e.resultat,niveau:e.niveau,courses:[]};e.courses&&e.courses.forEach(function(e){(function(e,t){return!(t.circuit&&e.circuit!==t.circuit||t.categorie&&e.categorie!==t.categorie||t.podium&&!h(e.finale))})(e,x)&&(c.courses.push(e),L++,(h(e.finale)||h(e.finaleB))&&A++)}),(c.courses.length>0||o&&!p)&&n.competitions.push(c)}});var a=p||g||b||y;(n.competitions.length>0||n.info&&!a)&&C.push(n)}}),c=C,d=""!==v,e.innerHTML="",c&&c.length>0?c.forEach(function(t,n){var a=d&&0===n;e.appendChild(E(t,a))}):e.innerHTML="<p>Aucun résultat disponible avec ces filtres.</p>",f=L,m=A,t.innerHTML=f>0?"<strong>"+f+"</strong> course(s) trouvée(s) dont <strong>"+m+"</strong> podium(s)":"Aucune course trouvée avec ces filtres",u=!1,s){var S=s.querySelector(".expand-icon"),I=s.querySelector(".expand-text");S.textContent="+",I.textContent="Tout déplier"}}}();